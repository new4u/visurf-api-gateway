# è´Ÿè½½å‡è¡¡ä½¿ç”¨è¯´æ˜

## ğŸ“– ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡ï¼Ÿ

è´Ÿè½½å‡è¡¡å°±æ˜¯æŠŠå¤§é‡è¯·æ±‚åˆ†é…ç»™å¤šä¸ªæœåŠ¡å™¨å¤„ç†ï¼Œé¿å…å•å°æœåŠ¡å™¨å‹åŠ›è¿‡å¤§ã€‚

```
å®¢æˆ·ç«¯è¯·æ±‚ â†’ Masterç½‘å…³ â†’ åˆ†é…ç»™ â†’ Worker1, Worker2, Worker3...
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨ä¸­å¿ƒç½‘å…³ï¼ˆMasterï¼‰

```bash
node src/simple-server.js
```

Master è¿è¡Œåœ¨ **4000** ç«¯å£ï¼Œè´Ÿè´£ï¼š
- æ¥æ”¶æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚
- é€‰æ‹©æœ€ä¼˜çš„ Worker èŠ‚ç‚¹
- è½¬å‘è¯·æ±‚å¹¶è¿”å›ç»“æœ

### 2. å¯åŠ¨å·¥ä½œèŠ‚ç‚¹ï¼ˆWorkerï¼‰

**å¯åŠ¨ç¬¬ä¸€ä¸ª Workerï¼š**
```bash
node worker-server.js --type=render --port=5001 --name=worker-1 --weight=2
```

**å¯åŠ¨ç¬¬äºŒä¸ª Workerï¼š**
```bash
node worker-server.js --type=render --port=5002 --name=worker-2 --weight=1
```

**å¯åŠ¨ç¬¬ä¸‰ä¸ª Workerï¼š**
```bash
node worker-server.js --type=render --port=5003 --name=worker-3 --weight=1
```

### 3. æŸ¥çœ‹å·²æ³¨å†Œçš„èŠ‚ç‚¹

```bash
curl http://localhost:4000/api/v1/worker/list
```

### 4. æµ‹è¯•è´Ÿè½½å‡è¡¡

```bash
node test-load-balancer.js
```

## ğŸ›ï¸ å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `--type` | æœåŠ¡ç±»å‹ï¼šrender/parse/combo | `--type=render` |
| `--port` | ç«¯å£å· | `--port=5001` |
| `--name` | èŠ‚ç‚¹åç§° | `--name=æˆ‘çš„èŠ‚ç‚¹` |
| `--weight` | æƒé‡ï¼ˆè¶Šå¤§å¤„ç†è¶Šå¤šè¯·æ±‚ï¼‰ | `--weight=2` |

## âš–ï¸ æƒé‡åˆ†é…è§„åˆ™

æƒé‡å†³å®šäº†èŠ‚ç‚¹å¤„ç†è¯·æ±‚çš„æ¯”ä¾‹ï¼š

```
Worker1: weight=3  â†’  å¤„ç† 50% çš„è¯·æ±‚
Worker2: weight=2  â†’  å¤„ç† 33% çš„è¯·æ±‚
Worker3: weight=1  â†’  å¤„ç† 17% çš„è¯·æ±‚
```

**å»ºè®®ï¼š**
- é«˜æ€§èƒ½æœåŠ¡å™¨ï¼šweight=3
- æ™®é€šæœåŠ¡å™¨ï¼šweight=2
- ä½é…æœåŠ¡å™¨ï¼šweight=1

## ğŸ”„ å·¥ä½œæµç¨‹

```
1. Worker å¯åŠ¨ â†’ è‡ªåŠ¨æ³¨å†Œåˆ° Master
2. Worker æ¯ 30 ç§’å‘é€å¿ƒè·³ä¿æŒåœ¨çº¿
3. å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾ Master
4. Master é€‰æ‹©æœ€ä¼˜ Worker
5. è½¬å‘è¯·æ±‚åˆ° Worker å¤„ç†
6. è¿”å›ç»“æœç»™å®¢æˆ·ç«¯
```

## ğŸ’¡ å¸¸è§åœºæ™¯

### åœºæ™¯1ï¼šæ·»åŠ æ–°èŠ‚ç‚¹ï¼ˆæ‰©å®¹ï¼‰

```bash
# ç›´æ¥å¯åŠ¨æ–°çš„ Workerï¼Œä¼šè‡ªåŠ¨åŠ å…¥è´Ÿè½½å‡è¡¡
node worker-server.js --type=render --port=5004 --name=worker-4
```

### åœºæ™¯2ï¼šèŠ‚ç‚¹æ•…éšœ

Worker æ•…éšœåä¼šè‡ªåŠ¨ä»è´Ÿè½½å‡è¡¡ä¸­ç§»é™¤ï¼Œè¯·æ±‚è½¬å‘åˆ°å…¶ä»–å¥åº·èŠ‚ç‚¹ã€‚

### åœºæ™¯3ï¼šæŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹
curl http://localhost:4000/api/v1/worker/list

# æŸ¥çœ‹å•ä¸ªèŠ‚ç‚¹è¯¦æƒ…
curl http://localhost:4000/api/v1/worker/{èŠ‚ç‚¹ID}

# æŸ¥çœ‹èŠ‚ç‚¹ç»Ÿè®¡
curl http://localhost:4000/api/v1/worker/{èŠ‚ç‚¹ID}/stats
```

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

æ¯ä¸ª Worker èŠ‚ç‚¹ä¼šè®°å½•ï¼š
- **æ€»è¯·æ±‚æ•°**ï¼šå¤„ç†çš„è¯·æ±‚æ€»æ•°
- **å¤±è´¥è¯·æ±‚æ•°**ï¼šå¤±è´¥çš„è¯·æ±‚æ•°
- **å¹³å‡å“åº”æ—¶é—´**ï¼šå¹³å‡å¤„ç†æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
- **å½“å‰è¿æ¥æ•°**ï¼šæ­£åœ¨å¤„ç†çš„è¯·æ±‚æ•°
- **CPU/å†…å­˜ä½¿ç”¨ç‡**ï¼šèµ„æºå ç”¨æƒ…å†µ

## ğŸ›¡ï¸ å®¹é”™æœºåˆ¶

### è‡ªåŠ¨æ•…éšœæ£€æµ‹
- Worker 60ç§’æ— å¿ƒè·³ â†’ è‡ªåŠ¨æ ‡è®°ä¸ºç¦»çº¿
- Master æ¯10ç§’æ£€æŸ¥ä¸€æ¬¡èŠ‚ç‚¹å¥åº·çŠ¶æ€

### è¯·æ±‚é‡è¯•
- Worker è¯·æ±‚å¤±è´¥ â†’ è‡ªåŠ¨é€‰æ‹©å…¶ä»–èŠ‚ç‚¹é‡è¯•
- æœ€å¤šé‡è¯• 3 æ¬¡

### ç†”æ–­ä¿æŠ¤
- Worker è¿ç»­å¤±è´¥ 5 æ¬¡ â†’ è§¦å‘ç†”æ–­ï¼Œæš‚åœä½¿ç”¨
- 60ç§’åè‡ªåŠ¨æ¢å¤

## ğŸ¯ æ€§èƒ½å»ºè®®

### å°å‹éƒ¨ç½²ï¼ˆæ—¥è®¿é—®é‡ < 1ä¸‡ï¼‰
```
1 Master + 2-3 Workers
```

### ä¸­å‹éƒ¨ç½²ï¼ˆæ—¥è®¿é—®é‡ 1-10ä¸‡ï¼‰
```
1 Master + 5-10 Workers
```

### å¤§å‹éƒ¨ç½²ï¼ˆæ—¥è®¿é—®é‡ > 10ä¸‡ï¼‰
```
1 Master + 10+ Workers
è€ƒè™‘éƒ¨ç½²å¤šä¸ª Master å®ç°é«˜å¯ç”¨
```

## ğŸ”§ æ•…éšœæ’æŸ¥

### Worker æ— æ³•æ³¨å†Œï¼Ÿ
1. æ£€æŸ¥ Master æ˜¯å¦è¿è¡Œï¼š`curl http://localhost:4000/health`
2. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
3. æŸ¥çœ‹ Worker æ—¥å¿—ï¼Œä¼šè‡ªåŠ¨é‡è¯•æ³¨å†Œ

### è¯·æ±‚æœªåˆ†å‘åˆ° Workerï¼Ÿ
1. ç¡®è®¤ Worker çŠ¶æ€ä¸º online
2. ç¡®è®¤ service_type åŒ¹é…ï¼ˆrender/parse/comboï¼‰
3. æŸ¥çœ‹ Master æ—¥å¿—

### Worker é¢‘ç¹ç¦»çº¿ï¼Ÿ
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. æ£€æŸ¥ Worker è¿›ç¨‹æ˜¯å¦ç¨³å®š
3. è°ƒæ•´å¿ƒè·³è¶…æ—¶æ—¶é—´

## ğŸ“ å®Œæ•´ç¤ºä¾‹

```bash
# 1. å¯åŠ¨ Master
node src/simple-server.js

# 2. å¯åŠ¨ 3 ä¸ª Render Workersï¼ˆæ–°å¼€3ä¸ªç»ˆç«¯ï¼‰
node worker-server.js --type=render --port=5001 --name=render-1 --weight=2
node worker-server.js --type=render --port=5002 --name=render-2 --weight=1
node worker-server.js --type=render --port=5003 --name=render-3 --weight=1

# 3. å¯åŠ¨ Parse Worker
node worker-server.js --type=parse --port=5004 --name=parse-1

# 4. æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€
curl http://localhost:4000/api/v1/worker/list

# 5. æµ‹è¯•è´Ÿè½½å‡è¡¡
node test-load-balancer.js
```

## ğŸ‰ ä¼˜åŠ¿

- âœ… **é«˜æ€§èƒ½**ï¼šå¤šèŠ‚ç‚¹å¹¶è¡Œå¤„ç†ï¼Œæå‡ååé‡
- âœ… **é«˜å¯ç”¨**ï¼šå•èŠ‚ç‚¹æ•…éšœä¸å½±å“æœåŠ¡
- âœ… **æ˜“æ‰©å±•**ï¼šéšæ—¶æ·»åŠ /åˆ é™¤èŠ‚ç‚¹
- âœ… **è‡ªåŠ¨åŒ–**ï¼šèŠ‚ç‚¹è‡ªåŠ¨æ³¨å†Œã€å¿ƒè·³ã€æ•…éšœåˆ‡æ¢
- âœ… **å¯ç›‘æ§**ï¼šå®æ—¶æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€å’Œæ€§èƒ½

---

**æ›´å¤šè¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹ï¼š**
- [LOAD_BALANCER.md](./LOAD_BALANCER.md) - å®Œæ•´æ¶æ„è®¾è®¡
- [QUICK_START_LOAD_BALANCER.md](./QUICK_START_LOAD_BALANCER.md) - è¯¦ç»†ä½¿ç”¨æŒ‡å—
